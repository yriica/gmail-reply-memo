# Gmail Reply Memo - Chrome拡張機能

Gmailのスレッドに「返信メモ」を追加できるChrome拡張機能です。返信の検討や下書き準備を効率化し、タスク管理を支援します。

## 主な機能

### ✨ メモ機能
- **スレッド単位のメモ**: 各Gmailスレッドに個別のメモを保存
- **自動保存**: 入力内容を自動的に保存（2秒のデバウンス）
- **Markdown対応**: シンプルなテキストエリアでMarkdown記法をサポート
- **リスト自動継続**: 箇条書き・番号付きリスト・チェックリストの入力を効率化
- **Shadow DOM**: Gmailの既存CSSと競合しない隔離された環境

### ✅ タスク管理
- **チェックリスト**: 返信に必要なタスクを管理
- **タスクの完了状態**: チェックボックスで進捗を追跡
- **未完タスクのフィルタ**: 残りのタスクだけを表示

### 🏷️ 整理機能
- **タグ**: 最大3つのタグを追加してメモを分類
- **重要フラグ**: 重要なメモに⭐マークを付与
- **全文検索**: すべてのメモを横断検索

### ⌨️ キーボードショートカット
- `Ctrl+Shift+M` (Mac: `Command+Shift+M`): メモパネルの表示/非表示
- 追加のショートカットは `chrome://extensions/shortcuts` で設定可能

### 🎨 UI/UX
- **Googleデザイン準拠**: Gmailの要約スタイルに統合された自然なデザイン
- **コンパクトなエディタ**: 初期表示は3行分、必要に応じてリサイズ可能
- **折りたたみ可能**: 必要な時だけ表示
- **日本語IME対応**: 変換確定とEnterキーを適切に区別

### 💾 データ管理
- **ローカル保存**: デフォルトでブラウザ内に保存（プライバシー保護）
- **エクスポート/インポート**: JSONファイルでデータをバックアップ
- **統計情報**: 保存されたメモ数や使用容量を表示

## インストール方法

### 開発モードでのインストール

1. このリポジトリをクローンまたはダウンロード
2. Chrome/Edgeを開き、`chrome://extensions/` にアクセス
3. 右上の「デベロッパーモード」を有効化
4. 「パッケージ化されていない拡張機能を読み込む」をクリック
5. このプロジェクトのフォルダを選択

### アイコンファイルについて

本拡張機能を正常に動作させるには、`icons/` ディレクトリに以下のアイコンファイルが必要です：

- `icon16.png` (16x16ピクセル)
- `icon48.png` (48x48ピクセル)
- `icon128.png` (128x128ピクセル)

現在、アイコンファイルは含まれていません。以下のいずれかの方法で用意してください：

1. **自分でアイコンを作成**: 📝 のようなメモアイコンをデザイン
2. **一時的なダミーアイコン**: 任意の画像を適切なサイズにリサイズして配置
3. **オンラインツールを使用**: [Favicon Generator](https://realfavicongenerator.net/) などでPNGアイコンを生成

アイコンがない場合でも拡張機能は動作しますが、警告が表示される場合があります。

## 使い方

### 基本的な使い方

1. Gmailでスレッドを開く
2. 画面上部にメモパネルが表示される
3. メモを入力（自動保存されます）
4. Markdown記法が使えます：
   - `# 見出し` - 見出し
   - `**太字**` - 太字
   - `*斜体*` - 斜体
   - `- リスト` - 箇条書き
   - `1. リスト` - 番号付きリスト
   - `- [ ] タスク` - チェックリスト

### Markdownリストの自動継続

リスト入力時にEnterキーを押すと、自動的に次の行にもリストマーカーが追加されます：

- **箇条書き**: `* 項目` → Enter → `* `（自動追加）
- **番号付き**: `1. 項目` → Enter → `2. `（自動インクリメント）
- **チェックリスト**: `- [ ] タスク` → Enter → `- [ ] `（自動追加）
- **リスト終了**: 空の項目でEnterを押すとリストを終了
- **インデント**: Tabキーで2スペースのインデント挿入

### チェックリストの追加

1. メモパネル内の「+ タスク追加」をクリック
2. タスク内容を入力
3. 完了したらチェックボックスをオン

### タグの追加

1. メモパネル下部の「タグを追加...」欄に入力
2. Enterキーで確定
3. 最大3つまで追加可能

### 検索とフィルタ

1. 拡張機能のアイコンをクリック
2. 検索ボックスにキーワードを入力
3. フィルタボタン（重要、未完タスク、すべて）で絞り込み
4. メモをクリックするとGmailのスレッドが開く

### データのエクスポート

**すべてのメモ:**
1. 拡張機能のポップアップで「エクスポート」をクリック
2. または、設定ページ（右クリック→オプション）から「すべてエクスポート」
3. JSONファイルとしてダウンロードされます

### データのインポート

1. 設定ページを開く
2. 「インポート」ボタンからJSONファイルを選択
3. 確認後、メモがインポートされる

## 設定

拡張機能のアイコンを右クリック→「オプション」で設定画面を開きます。

### 利用可能な設定

- **保存先**: ローカル or 同期（Chrome同期ストレージ）
- **自動保存間隔**: デバウンス時間を調整
- **受信トレイバッジ**: 期限付きメモのバッジ表示
- **バッジ表示期間**: 3日/7日/14日/30日から選択

## 技術仕様

### アーキテクチャ

- **Manifest Version**: V3
- **Content Script**: Gmail画面にUI注入、スレッド検知
- **Service Worker**: コマンド処理、メッセージング
- **Shadow DOM**: CSS隔離、競合回避
- **Chrome Storage API**: データ永続化

### ファイル構成

```
gmail-reply-memo/
├── manifest.json          # 拡張機能の設定
├── content.js             # Gmail画面に注入されるスクリプト
├── background.js          # バックグラウンドサービスワーカー
├── popup.html             # ポップアップUI（検索）
├── popup.js               # ポップアップのロジック
├── options.html           # 設定ページUI
├── options.js             # 設定ページのロジック
├── icons/                 # アイコンファイル（要準備）
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
└── GMAIL_MEMO_README.md   # このファイル
```

### データ構造

```json
{
  "version": 1,
  "memos": {
    "0#threadId123": {
      "content": "メモ本文（Markdown形式）",
      "important": true,
      "tags": ["見積", "至急"],
      "tasks": [
        {"id": "t1", "text": "タスク内容", "done": false}
      ],
      "dueDate": 1730966400000,
      "reminderEnabled": true,
      "threadSubject": "件名",
      "threadSender": "送信者名",
      "updatedAt": 1730966400000
    }
  }
}
```

- **キー形式**: `{userAccountId}#{threadId}`
- **userAccountId**: Gmailの `/u/{index}/` から取得（デフォルトは "0"）
- **threadId**: URLやDOM属性から抽出
- **content**: Markdown形式のテキスト
- **dueDate**: 返信期限（タイムスタンプ）
- **reminderEnabled**: リマインダー有効フラグ
- **threadSubject**: スレッド件名（自動取得）
- **threadSender**: 送信者名（自動取得）

### ブラウザ互換性

- **対応**: Google Chrome（最新版）、Chromium系ブラウザ（Microsoft Edge等）
- **必須**: Manifest V3 対応ブラウザ

## プライバシーとセキュリティ

### データの取り扱い

- **ローカル保存**: デフォルトではブラウザ内のみに保存
- **外部送信なし**: インターネットへのデータ送信は一切なし
- **最小権限**: `storage` と `host_permissions` のみ使用

### 同期ストレージについて

- オプションで `chrome.storage.sync` を選択可能
- Googleアカウント経由でChrome間同期
- 容量制限: 100KB（メモ数に応じて注意）

### 免責事項

- 本拡張機能はGoogle/Gmailとは無関係です
- データ損失に備えて定期的なエクスポートを推奨
- 重要な情報は必ず他の場所にもバックアップしてください

## トラブルシューティング

### メモが保存されない

- ブラウザのストレージが有効か確認
- 開発者ツール（F12）のConsoleでエラーを確認
- 拡張機能を一度無効化→有効化

### パネルが表示されない

- URLが `mail.google.com` か確認
- ページをリロード（F5）
- スレッド画面を開いているか確認

### ショートカットキーが動かない

- `chrome://extensions/shortcuts` で設定を確認
- 他の拡張機能とキーが競合していないか確認

### Gmailの画面が崩れる

- Shadow DOMで隔離しているため通常は発生しません
- 問題がある場合は拡張機能を無効化してご報告ください

### リスト入力で文字が重複する

- 日本語入力時の変換確定を優先する仕組みを実装済み
- それでも問題がある場合はブラウザのバージョンを確認してください
- 最新版のChromeでの使用を推奨

## 既知の制限事項

### 現在の制限

- **Gmail Webのみ**: モバイルアプリには非対応
- **Markdown表示**: 入力はMarkdown、表示はプレーンテキスト
- **DOM依存**: GmailのUI変更で動作不良の可能性

### v0.3.0での改善点

- ✅ 軽量化: 外部ライブラリ依存を削除
- ✅ 安定性向上: シンプルなテキストエリアで確実に動作
- ✅ UX改善: リスト自動継続でMarkdown入力を効率化
- ✅ 日本語対応: IME変換を適切に処理

### 今後の改善予定

- Markdownプレビュー機能
- Gmail API連携（下書き自動作成）
- テンプレート機能の拡充
- クラウド同期オプション（Google Drive等）

## 開発者向け情報

### デバッグ方法

1. `chrome://extensions/` で拡張機能の詳細を開く
2. 「バックグラウンドページを検証」でService Workerをデバッグ
3. Gmail画面でF12を開き、Consoleでログを確認

### Content Scriptのデバッグ

```javascript
// Shadow Root内の要素を確認
document.querySelector('#gmail-reply-memo-container').shadowRoot
```

### ビルド/パッケージ方法

現在はビルドプロセス不要（Vanilla JS）

**配布用パッケージの作成:**

```bash
# iconsディレクトリにアイコンファイルを配置後
zip -r gmail-reply-memo.zip manifest.json *.js *.html icons/ -x "*.DS_Store"
```

## ライセンス

MIT License

## 貢献

Issue報告や Pull Request を歓迎します！

### 開発環境のセットアップ

```bash
git clone <repository-url>
cd gmail-reply-memo
# アイコンファイルを icons/ に配置
# chrome://extensions/ から読み込み
```

## サポート

- **バグ報告**: GitHubのIssueを作成
- **機能要望**: GitHubのIssueで "enhancement" ラベルを使用
- **質問**: GitHubのDiscussionsを利用

---

**⚠️ 注意**: この拡張機能はGmailの非公式ツールです。GmailのUI変更により動作しなくなる可能性があります。重要なデータは必ず別途バックアップしてください。
