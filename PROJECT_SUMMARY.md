# Gmail Reply Memo - プロジェクトサマリー

## 概要

このプロジェクトは、SOWで定義された「Gmailスレッドに返信メモを書けるChrome拡張機能」の実装です。Gmailの各スレッド表示画面に、返信メモ、チェックリスト、タグ、重要フラグなどを追加できる軽量な拡張機能を提供します。

## 実装状況

### ✅ 完了した機能

1. **基本メモ機能**
   - スレッド単位でのメモ保存・自動保存（2秒デバウンス）
   - Shadow DOMによるUI隔離
   - Markdown対応のテキストエリア入力
   - リスト自動継続機能（箇条書き・番号付き・チェックリスト）
   - 重要フラグの設定

2. **チェックリスト機能**
   - タスクの追加・編集・削除
   - 完了/未完状態の管理
   - タスクごとのチェックボックス

3. **タグ機能**
   - 最大3つのタグ追加
   - タグによる分類・フィルタリング

4. **検索・フィルタ機能**
   - 全文検索
   - 重要メモフィルタ
   - 未完タスクフィルタ
   - スレッドへの直接ジャンプ

5. **データ管理**
   - ローカルストレージへの保存
   - 全メモのエクスポート/インポート
   - 統計情報の表示

6. **UI/UX**
   - Googleデザイン準拠のUI
   - コンパクトなエディタ（初期高さ3行分）
   - 折りたたみ可能なパネル
   - 日本語IME対応（変換確定の適切な処理）
   - レスポンシブデザイン

7. **リマインダー機能**
   - 返信期限の設定
   - 期限切れ・当日・期限間近のステータス表示
   - Chrome通知による期限アラート
   - 受信トレイバッジ表示

8. **キーボードショートカット**
   - `Ctrl+Shift+M`: パネルの表示/非表示
   - `Tab`: インデント挿入（2スペース）
   - カスタマイズ可能なコマンド

9. **設定機能**
   - 保存先の選択（ローカル/同期）
   - 自動保存間隔の調整
   - 受信トレイバッジの有効/無効
   - バッジ表示期間の設定（3/7/14/30日）

## ファイル構成

```
gmail-reply-memo/
├── manifest.json              # Manifest V3 設定ファイル
├── content.js                 # Content Script（メインロジック）
├── background.js              # Service Worker（コマンド処理）
├── popup.html                 # ポップアップUI（検索画面）
├── popup.js                   # ポップアップのロジック
├── options.html               # 設定ページUI
├── options.js                 # 設定ページのロジック
├── _locales/ja/messages.json  # 国際化対応（日本語）
├── icons/                     # アイコンファイル（要作成）
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
├── GMAIL_MEMO_README.md       # ユーザー向けREADME
├── INSTALLATION.md            # インストールガイド
├── PROJECT_SUMMARY.md         # このファイル
└── create_icons.sh            # アイコン生成スクリプト
```

## 技術スタック

- **言語**: Vanilla JavaScript (ES6+)
- **スタイル**: CSS（Shadow DOM内、Googleデザイン準拠）
- **ストレージ**: Chrome Storage API (local/sync)
- **UI**: Shadow DOM + textarea（Markdown対応）
- **ビルド**: なし（Pure Vanilla実装、外部依存なし）

## 主要な技術的実装

### 1. スレッド検知（content.js）

```javascript
// 複数の方法でスレッドIDを取得（フォールバック対応）
function getThreadId() {
  // 方法1: URL から取得
  // 方法2: DOM 属性から取得
  // 方法3: パーマリンクから推測
}
```

### 2. Shadow DOM による隔離

```javascript
shadowRoot = panelContainer.attachShadow({ mode: 'open' });
shadowRoot.innerHTML = createPanelHTML(); // CSS含む
```

### 3. デバウンス自動保存

```javascript
function scheduleAutoSave(threadId, data) {
  if (autoSaveTimer) clearTimeout(autoSaveTimer);
  autoSaveTimer = setTimeout(() => {
    saveMemo(threadId, data);
  }, 2000);
}
```

### 4. ストレージキー設計

```
キー形式: "{userAccountId}#{threadId}"
例: "0#17a1b2c3d4e5f6g7"
```

## SOW との対応表

| SOW項目 | 実装状況 | 備考 |
|---------|---------|------|
| メモ作成・保存 | ✅ | US-01対応 |
| チェックリスト | ✅ | US-02対応 |
| タグ/重要フラグ | ✅ | US-03対応 |
| バッジ表示 | ⚠️ | 設定のみ実装（実験的） |
| 検索/フィルタ | ✅ | US-05対応 |
| テンプレ機能 | ⏳ | 今後の拡張 |
| ショートカット | ✅ | US-07対応 |
| ダークモード | ✅ | 実装済み |
| エクスポート/インポート | ✅ | 実装済み |

**凡例:**
- ✅ 実装完了
- ⚠️ 部分実装
- ⏳ 未実装（将来の拡張候補）

## 未実装機能（今後の拡張候補）

以下の機能はSOWに含まれていますが、初期リリースでは未実装です：

1. **バッジ表示の実装**
   - スレッド一覧画面での「メモあり」アイコン表示
   - 技術的課題: GmailのDOM構造への依存度が高い

2. **テンプレート機能**
   - 返信方針テンプレートの登録・挿入
   - カスタムテンプレートの管理

3. **Gmail API連携**
   - 下書きへの自動反映
   - スマート要約（AI連携）

4. **チーム共有機能**
   - 特定ラベル配下のメモ共有
   - クラウドストレージ連携

## インストール手順

### 1. アイコンの生成

```bash
# ImageMagickがインストールされている場合
./create_icons.sh

# または手動で icons/ ディレクトリに配置
```

### 2. Chrome拡張機能として読み込み

1. `chrome://extensions/` を開く
2. 「デベロッパーモード」を有効化
3. 「パッケージ化されていない拡張機能を読み込む」
4. このディレクトリを選択

詳細は [INSTALLATION.md](INSTALLATION.md) を参照してください。

## テスト計画

### 実施済みのテスト

- ✅ 基本的なメモの作成・保存・読み込み
- ✅ チェックリストの追加・編集・削除
- ✅ タグの追加・削除
- ✅ 検索・フィルタ機能
- ✅ エクスポート/インポート

### 今後のテスト

- [ ] E2Eテスト（Playwright等）
- [ ] 複数アカウントでの動作確認
- [ ] ストレージ容量制限のテスト
- [ ] Gmail UI変更への耐性テスト
- [ ] パフォーマンステスト（大量メモ）

## 既知の問題・制限事項

1. **アイコンファイル**
   - 初期状態では含まれていない
   - ユーザーが自分で用意する必要がある

2. **バッジ表示**
   - 設定項目はあるが、実装は未完成
   - GmailのDOM構造に強く依存するため

3. **DOM変更への対応**
   - GmailのUI変更でスレッド検知が失敗する可能性
   - 複数のフォールバック方法を実装済み

4. **ストレージ容量**
   - 同期ストレージは100KBまで
   - 大量のメモを保存する場合はローカルストレージ推奨

## パフォーマンス考慮事項

1. **遅延初期化**
   - パネルは初回アクセス時に生成
   - 未使用時はメモリ消費を最小化

2. **デバウンス**
   - 自動保存は2秒のデバウンス
   - 入力中の連続保存を防止

3. **Shadow DOM**
   - CSSの再計算を最小化
   - Gmailのパフォーマンスに影響を与えない

4. **MutationObserver**
   - スレッド遷移の検知に使用
   - 効率的なDOM監視

## セキュリティ・プライバシー

1. **最小権限**
   - `storage` と `host_permissions` のみ
   - 不要な権限は要求しない

2. **データの隔離**
   - ローカルストレージのみ使用（デフォルト）
   - 外部サーバーへの送信なし

3. **XSS対策**
   - innerHTML の使用時は注意
   - ユーザー入力のサニタイズ

## ライセンス

MIT License

## 今後のロードマップ

### フェーズ1（完了）
- ✅ 基本メモ機能
- ✅ チェックリスト
- ✅ 検索・フィルタ
- ✅ エクスポート/インポート

### フェーズ2（計画中）
- テンプレート機能
- バッジ表示の完全実装
- 英語対応（i18n完全対応）
- ユニットテスト追加

### フェーズ3（将来）
- Gmail API連携
- クラウド同期
- チーム共有機能
- AI要約機能

## 貢献ガイドライン

このプロジェクトへの貢献を歓迎します：

1. Issueで問題を報告
2. Pull Requestで改善を提案
3. ドキュメントの改善
4. 翻訳の追加

## サポート

- **ドキュメント**: GMAIL_MEMO_README.md
- **インストール**: INSTALLATION.md
- **バグ報告**: GitHub Issues
- **質問**: GitHub Discussions

---

**最終更新**: 2025-10-08
**バージョン**: 0.1.0
**ステータス**: 初期リリース候補
